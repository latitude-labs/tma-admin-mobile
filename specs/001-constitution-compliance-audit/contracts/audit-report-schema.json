{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://tma-admin-mobile/audit-report.schema.json",
  "title": "Constitution Compliance Audit Report",
  "description": "Complete audit report structure for TMA Admin Mobile constitution compliance",
  "type": "object",
  "required": [
    "auditRun",
    "summary",
    "principleResults",
    "violationsByFile",
    "violationsBySeverity",
    "recommendations"
  ],
  "properties": {
    "auditRun": {
      "$ref": "#/definitions/AuditRun"
    },
    "summary": {
      "$ref": "#/definitions/AuditSummary"
    },
    "principleResults": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/PrincipleCompliance"
      },
      "minItems": 7,
      "maxItems": 7
    },
    "violationsByFile": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/FileAnalysis"
      }
    },
    "violationsBySeverity": {
      "type": "object",
      "properties": {
        "critical": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Violation"
          }
        },
        "high": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Violation"
          }
        },
        "medium": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Violation"
          }
        },
        "low": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Violation"
          }
        }
      },
      "required": ["critical", "high", "medium", "low"]
    },
    "trendData": {
      "$ref": "#/definitions/TrendData"
    },
    "recommendations": {
      "type": "array",
      "items": {
        "type": "string"
      }
    }
  },
  "definitions": {
    "AuditRun": {
      "type": "object",
      "required": [
        "id",
        "timestamp",
        "constitutionVersion",
        "branch",
        "commitHash",
        "filesAnalyzed",
        "totalViolations",
        "healthScore",
        "principles",
        "duration",
        "config"
      ],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}-\\d{6}$",
          "description": "Unique identifier (YYYY-MM-DD-HHmmss)"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "constitutionVersion": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Semantic version of constitution"
        },
        "branch": {
          "type": "string"
        },
        "commitHash": {
          "type": "string",
          "pattern": "^[0-9a-f]{7,40}$"
        },
        "filesAnalyzed": {
          "type": "integer",
          "minimum": 1
        },
        "totalViolations": {
          "type": "integer",
          "minimum": 0
        },
        "healthScore": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "principles": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/PrincipleCompliance"
          },
          "minItems": 7,
          "maxItems": 7
        },
        "duration": {
          "type": "integer",
          "minimum": 0,
          "description": "Audit duration in milliseconds"
        },
        "config": {
          "$ref": "#/definitions/AuditConfig"
        }
      }
    },
    "PrincipleCompliance": {
      "type": "object",
      "required": [
        "principleId",
        "principleName",
        "compliancePercentage",
        "totalChecks",
        "passedChecks",
        "failedChecks",
        "violations",
        "weight"
      ],
      "properties": {
        "principleId": {
          "type": "string",
          "enum": [
            "principle-1-design-system",
            "principle-2-type-safety",
            "principle-3-component-architecture",
            "principle-4-accessibility",
            "principle-5-performance",
            "principle-6-state-management",
            "principle-7-testing-documentation"
          ]
        },
        "principleName": {
          "type": "string"
        },
        "compliancePercentage": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "totalChecks": {
          "type": "integer",
          "minimum": 0
        },
        "passedChecks": {
          "type": "integer",
          "minimum": 0
        },
        "failedChecks": {
          "type": "integer",
          "minimum": 0
        },
        "violations": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Violation"
          }
        },
        "weight": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Weight in health score calculation"
        }
      }
    },
    "Violation": {
      "type": "object",
      "required": [
        "id",
        "file",
        "line",
        "principleId",
        "ruleId",
        "severity",
        "message",
        "remediation"
      ],
      "properties": {
        "id": {
          "type": "string",
          "description": "Format: {file}:{line}:{ruleId}"
        },
        "file": {
          "type": "string",
          "description": "Relative file path from repo root"
        },
        "line": {
          "type": "integer",
          "minimum": 1
        },
        "lineEnd": {
          "type": "integer",
          "minimum": 1
        },
        "column": {
          "type": "integer",
          "minimum": 0
        },
        "principleId": {
          "type": "string"
        },
        "ruleId": {
          "type": "string"
        },
        "severity": {
          "type": "string",
          "enum": ["critical", "high", "medium", "low"]
        },
        "message": {
          "type": "string"
        },
        "remediation": {
          "$ref": "#/definitions/Remediation"
        },
        "codeSnippet": {
          "type": "string"
        }
      }
    },
    "Remediation": {
      "type": "object",
      "required": ["description", "autoFixAvailable"],
      "properties": {
        "description": {
          "type": "string"
        },
        "claudeMdReference": {
          "type": "string",
          "pattern": "CLAUDE\\.md:\\d+-\\d+"
        },
        "codeExample": {
          "type": "string"
        },
        "autoFixAvailable": {
          "type": "boolean"
        },
        "estimatedEffort": {
          "type": "string"
        }
      }
    },
    "FileAnalysis": {
      "type": "object",
      "required": [
        "file",
        "linesOfCode",
        "violations",
        "complianceStatus",
        "principlesAffected",
        "severityBreakdown"
      ],
      "properties": {
        "file": {
          "type": "string"
        },
        "linesOfCode": {
          "type": "integer",
          "minimum": 1
        },
        "violations": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Violation"
          }
        },
        "complianceStatus": {
          "type": "string",
          "enum": ["compliant", "violations", "error"]
        },
        "principlesAffected": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "uniqueItems": true
        },
        "severityBreakdown": {
          "$ref": "#/definitions/SeverityCount"
        }
      }
    },
    "SeverityCount": {
      "type": "object",
      "required": ["critical", "high", "medium", "low", "total"],
      "properties": {
        "critical": {
          "type": "integer",
          "minimum": 0
        },
        "high": {
          "type": "integer",
          "minimum": 0
        },
        "medium": {
          "type": "integer",
          "minimum": 0
        },
        "low": {
          "type": "integer",
          "minimum": 0
        },
        "total": {
          "type": "integer",
          "minimum": 0
        }
      }
    },
    "AuditConfig": {
      "type": "object",
      "required": ["constitutionVersion", "exclude", "include", "reportFormats"],
      "properties": {
        "constitutionVersion": {
          "type": "string"
        },
        "exclude": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "include": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "severityOverrides": {
          "type": "object",
          "additionalProperties": {
            "type": "string",
            "enum": ["critical", "high", "medium", "low"]
          }
        },
        "reportFormats": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["markdown", "json", "console"]
          },
          "minItems": 1
        }
      }
    },
    "AuditSummary": {
      "type": "object",
      "required": [
        "healthScore",
        "filesAnalyzed",
        "totalViolations",
        "severityCounts",
        "topViolatedPrinciple",
        "topCompliantPrinciple"
      ],
      "properties": {
        "healthScore": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "filesAnalyzed": {
          "type": "integer",
          "minimum": 1
        },
        "totalViolations": {
          "type": "integer",
          "minimum": 0
        },
        "severityCounts": {
          "$ref": "#/definitions/SeverityCount"
        },
        "topViolatedPrinciple": {
          "type": "string"
        },
        "topCompliantPrinciple": {
          "type": "string"
        }
      }
    },
    "TrendData": {
      "type": "object",
      "required": [
        "previousAuditId",
        "healthScoreChange",
        "violationChange",
        "principleChanges",
        "trend"
      ],
      "properties": {
        "previousAuditId": {
          "type": "string"
        },
        "healthScoreChange": {
          "type": "number",
          "description": "Positive = improvement, negative = decline"
        },
        "violationChange": {
          "type": "integer",
          "description": "Negative = fewer violations (good)"
        },
        "principleChanges": {
          "type": "object",
          "additionalProperties": {
            "type": "number"
          },
          "description": "Per-principle compliance percentage change"
        },
        "trend": {
          "type": "string",
          "enum": ["improving", "declining", "stable"]
        }
      }
    }
  }
}
